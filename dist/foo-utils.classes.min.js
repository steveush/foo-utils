/*!
* FooUtils - Contains common utility methods and classes used in our plugins.
* @version 1.0.0
* @link https://github.com/steveush/foo-utils#readme
* @copyright Steve Usher 2021
* @license Released under the GPL-3.0 license.
*/

"use strict";!function(s,i,o,a){"1.0.0"===s.version&&(s.Class=function(){},s.Class.extend=function(e){e=i.hash(e)?e:{};var t=o.create(this.prototype);for(var n in e)e.hasOwnProperty(n)&&a.addOrOverride(t,n,e[n]);function r(){if(!i.fn(this.construct))throw new SyntaxError('FooUtils.Class objects must be constructed with the "new" keyword.');this.construct.apply(this,arguments)}return t.construct=i.fn(t.construct)?t.construct:function(){},(r.prototype=t).constructor=i.fn(t.__ctor__)?t.__ctor__:r,r.extend=s.Class.extend,r.override=s.Class.override,r.getBaseClasses=s.Class.getBaseClasses,r.__baseClass__=this,r},s.Class.override=function(e,t){a.addOrOverride(this.prototype,e,t)},s.Class.__baseClass__=null,s.Class.getBaseClasses=function(){return function e(t,n){return i.array(n)||(n=[]),i.fn(t)&&null!==t.__baseClass__?(n.unshift(t.__baseClass__),e(t.__baseClass__,n)):n}(this,[])})}((FooUtils.$,FooUtils),FooUtils.is,FooUtils.obj,FooUtils.fn),function(e,a,u,s){e.ClassRegistry=e.Class.extend({construct:function(e){this.opt=s.extend({allowBase:!0,beforeCreate:null},e),this.registered={}},register:function(e,t,n,r){if(a.string(e)&&!a.empty(e)&&a.fn(t)){r=a.number(r)?r:0;var s=this.registered[e];return this.registered[e]={name:e,ctor:t,config:a.hash(n)?n:{},priority:a.undef(s)?r:s.priority},!0}return!1},each:function(e,t,n){t=!!a.boolean(t)&&t,n=a.undef(n)?e:n;var r=this,s=Object.keys(r.registered).map(function(e){return r.registered[e]});t&&s.sort(function(e,t){return t.priority-e.priority});for(var i=0,o=s.length;i<o;i++){if(!1===e.call(n,s[i],i))break}},find:function(e,t,n){t=!!a.boolean(t)&&t,n=a.undef(n)?e:n;var r=this,s=Object.keys(r.registered).map(function(e){return r.registered[e]});t&&s.sort(function(e,t){return t.priority-e.priority});for(var i=0,o=s.length;i<o;i++)if(e.call(n,s[i],i))return s[i];return null},create:function(e,t,n){var r=this,s=u.arg2arr(arguments);if(e=s.shift(),a.string(e)&&r.registered.hasOwnProperty(e)){var i=r.registered[e],o=!0;if(i.priority<0&&!r.opt.allowBase&&(o=!1),o&&a.fn(i.ctor))return t=s.shift(),t=r.mergeConfigurations(i.name,t),s.unshift.apply(s,[i.name,t]),u.apply(i.ctor,r.onBeforeCreate(i,s))}return null},onBeforeCreate:function(e,t){return null!==this.opt.beforeCreate&&a.fn(this.opt.beforeCreate)?this.opt.beforeCreate.call(this,e,t):t},mergeConfigurations:function(e,t){if(a.string(e)&&this.registered.hasOwnProperty(e)){t=a.hash(t)?t:{};var n=this.getBaseClasses(e),r=[{}];return n.push(this.registered[e]),n.forEach(function(e){r.push(e.config)}),r.push(t),s.extend.apply(s,r)}return{}},getBaseClass:function(){return this.find(function(e){return e.priority<0},!0)},getBaseClasses:function(e){var n=this,t=n.registered[e],r=[];return a.undef(t)||t.ctor.getBaseClasses().forEach(function(e){var t=n.fromType(e);a.hash(t)&&r.push(t)}),r},fromType:function(t){if(a.fn(t))return this.find(function(e){return e.ctor===t})}})}((FooUtils.$,FooUtils),FooUtils.is,FooUtils.fn,FooUtils.obj),function(o,a,n){"1.0.0"===o.version&&(o.Event=o.Class.extend({construct:function(e){if(a.empty(e))throw new SyntaxError("FooUtils.Event objects must be supplied a `type`.");var t=o.Event.parse(e);this.type=t.type,this.namespace=t.namespace,this.defaultPrevented=!1,this.target=null},preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return this.defaultPrevented}}),o.Event.parse=function(e){e=a.string(e)&&!a.empty(e)?e:null;var t=n.contains(e,".");return{namespaced:t,type:t?n.startsWith(e,".")?null:n.until(e,"."):e,namespace:t?n.from(e,"."):null}},o.EventClass=o.Class.extend({construct:function(){this.events={}},destroy:function(){this.events={}},on:function(n,t,r){var s=this;return a.object(n)?(r=t,Object.keys(n).forEach(function(t){a.fn(n[t])&&t.split(" ").forEach(function(e){s.addListener(e,n[t],r)})})):a.string(n)&&a.fn(t)&&n.split(" ").forEach(function(e){s.addListener(e,t,r)}),s},addListener:function(e,t,n){if(!a.string(e)||/\s/.test(e)||!a.fn(t))return!1;var r=this,s=o.Event.parse(e);return n=a.undef(n)?r:n,a.array(r.events[s.type])||(r.events[s.type]=[]),!r.events[s.type].some(function(e){return e.namespace===s.namespace&&e.fn===t&&e.thisArg===n})&&(r.events[s.type].push({namespace:s.namespace,fn:t,thisArg:n}),!0)},off:function(n,t,r){var s=this;return a.object(n)?(r=t,Object.keys(n).forEach(function(t){t.split(" ").forEach(function(e){s.removeListener(e,n[t],r)})})):a.string(n)&&n.split(" ").forEach(function(e){s.removeListener(e,t,r)}),s},removeListener:function(e,t,n){if(!a.string(e)||/\s/.test(e))return!1;var r=this,s=o.Event.parse(e),i=[];return n=a.undef(n)?r:n,a.empty(s.type)?a.empty(s.namespace)||i.push.apply(i,Object.keys(r.events)):i.push(s.type),i.forEach(function(e){a.array(r.events[e])&&(r.events[e]=r.events[e].filter(function(e){return null!=t?!(e.namespace===s.namespace&&e.fn===t&&e.thisArg===n):null!=s.namespace&&e.namespace!==s.namespace}),0===r.events[e].length&&delete r.events[e])}),!0},trigger:function(e,n){n=a.array(n)?n:[];var r=this,s=[];return e instanceof o.Event?(s.push(e),r.emit(e,n)):a.string(e)&&e.split(" ").forEach(function(e){var t=new o.Event(e);s.push(t),r.emit(t,n)}),a.empty(s)?null:1===s.length?s[0]:s},emit:function(t,n){var e;t instanceof FooUtils.Event&&(e=this,n=a.array(n)?n:[],null===t.target&&(t.target=e),a.array(e.events[t.type])&&e.events[t.type].forEach(function(e){null!=t.namespace&&e.namespace!==t.namespace||e.fn.apply(e.thisArg,[t].concat(n))}),a.array(e.events.__all__)&&e.events.__all__.forEach(function(e){e.fn.apply(e.thisArg,[t].concat(n))}))}}))}(FooUtils,FooUtils.is,FooUtils.str);